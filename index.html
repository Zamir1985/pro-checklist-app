<!-- =========================
FILE: index.html
========================= -->
<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <title>PRO Trend Verification Map V2.1 ‚Äî Offline Checklist</title>

  <!-- iOS 26 / PWA: zoom a√ßƒ±q + safe-area -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1,
                 maximum-scale=5, user-scalable=yes,
                 viewport-fit=cover" />

  <!-- PWA / iOS -->
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="pro_icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="pro_icon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="pro_icon.png">

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">

  <style>
    :root {
      --bg: #020617;
      --card: #0b1120;
      --card-soft: #111827;
      --accent: #fbbf24;
      --accent-soft: #6b7280;
      --danger: #f97373;
      --success: #22c55e;
      --text: #e5e7eb;
      --muted: #9ca3af;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html, body { height: 100%; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827, #020617);
      color: var(--text);
      padding: 8px;
      overscroll-behavior: none;
      -webkit-text-size-adjust: 100%;
    }

    /* iOS: input/textarea se√ßimi normal qalsƒ±n */
    input, textarea {
      -webkit-user-select: text;
      user-select: text;
    }

    .app {
      max-width: 900px;
      margin: 0 auto 32px auto;
      padding-bottom: env(safe-area-inset-bottom);
    }

    h1 {
      font-size: 1.25rem;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 10px;
      line-height: 1.35;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .pill {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.68rem;
      border: 1px solid #374151;
      color: var(--muted);
    }
    .pill.critical { border-color: var(--accent); color: var(--accent); }

    .btn {
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: transparent;
      color: var(--text);
      padding: 4px 10px;
      font-size: 0.72rem;
      cursor: pointer;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }

    .btn.primary {
      border-color: var(--accent);
      background: linear-gradient(135deg, #fbbf24, #f97316);
      color: #020617;
      font-weight: 600;
    }

    .btn.small {
      padding: 3px 8px;
      font-size: 0.68rem;
    }

    .top-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin-bottom: 8px;
      font-size: 0.75rem;
    }

    .score-bar {
      margin-top: 2px;
      color: var(--muted);
    }

    .score-value {
      font-weight: 600;
      color: var(--accent);
    }

    .hf-flag {
      margin-left: 6px;
      font-size: 0.72rem;
    }
    .hf-ok { color: var(--success); }
    .hf-bad { color: var(--danger); }

    .mode-switch {
      display: flex;
      gap: 6px;
      margin-left: auto;
      flex-wrap: wrap;
    }

    .btn.active-mode {
      background: linear-gradient(135deg, #fbbf24, #f97316);
      color: #020617;
      border-color: #fbbf24;
      font-weight: 600;
    }

    .sections {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .section {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.8));
      border-radius: 12px;
      padding: 6px 8px 7px;
      border: 1px solid #111827;
      will-change: transform;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
    }

    .section-title {
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge {
      font-size: 0.62rem;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid #374151;
      color: var(--muted);
      white-space: nowrap;
    }
    .badge.critical { border-color: var(--accent); color: var(--accent); }

    .section-score {
      font-size: 0.7rem;
      color: var(--muted);
      white-space: nowrap;
    }

    .collapse-icon {
      font-size: 0.7rem;
      color: var(--muted);
      margin-left: 4px;
      display: inline-block;
      transition: transform 120ms ease, opacity 120ms ease;
    }

    .section.collapsed .items { display: none; }
    .section.collapsed .collapse-icon { transform: rotate(-90deg); opacity: 0.7; }

    .item {
      background: var(--card);
      border-radius: 9px;
      padding: 5px 6px;
      border: 1px solid #020617;
      margin-top: 6px;
    }

    .item-title {
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 1px;
    }

    .item-desc {
      font-size: 0.68rem;
      color: var(--muted);
      margin-bottom: 4px;
      line-height: 1.25;
    }
  </style>
</head>

<body>
<div class="app">

  <h1>PRO Trend Verification Map ‚Äî FULL MODE V2.1</h1>
  <div class="subtitle">
    START siqnalƒ±ndan sonra 10‚Äì20 saniy…ôy…ô b√ºt√ºn PRO x…ôrit…ôni yoxlamaq √º√ß√ºn offline checklist.
    V2.1: Hard-Fail sistemi, kompakt UI, collapse b√∂lm…ôl…ôr, Telegram export, LONG/SHORT REAL MODE,
    LocalStorage Trade Log, JSON Export/Import, Session Comparison V2.1.
  </div>

  <div class="pill-row">
    <div class="pill critical">0. Q…ôrar filteri ‚Üí yalnƒ±z g√ºcl√º impulslar</div>
    <div class="pill">B√∂lm…ô 1: Futures Real Impulse (8)</div>
    <div class="pill">B√∂lm…ô 2: Spot Confirmation (4)</div>
    <div class="pill">B√∂lm…ô 3: Extra PRO (6)</div>
    <div class="pill">B√∂lm…ô 4: Market Structure (2)</div>
    <div class="pill">B√∂lm…ô 5: BTC Regime (1)</div>
  </div>

  <div class="top-bar">
    <div style="display:flex;gap:6px;flex-wrap:wrap;">
      <button id="btnResetAll" class="btn primary" type="button">Reset All</button>
      <button id="btnCopyExport" class="btn small" type="button">Copy Export</button>
    </div>
    <div class="score-bar">
      Overall Score: <span id="overallScore" class="score-value">0</span> / 21
      <span id="hfStatus" class="hf-flag hf-ok">Hard-Fail: Yox</span>
    </div>
    <div class="mode-switch">
      <button id="modeLong" class="btn small active-mode" type="button">LONG</button>
      <button id="modeShort" class="btn small" type="button">SHORT</button>
    </div>
  </div>

  <div class="sections" id="sectionsRoot">

    <!-- SECTION 0 -->
    <div class="section">
      <div class="section-header" role="button" aria-label="Collapse Section 0">
        <div class="section-title">
          üîµ 0. Q…ôrar Filteri
          <span class="badge critical">ƒ∞lk 5‚Äì10 saniy…ô</span>
        </div>
        <div class="section-score"><span class="collapse-icon">‚ñº</span></div>
      </div>
      <div class="items">
        <div style="font-size:0.72rem;color:var(--muted);line-height:1.35;">
          START siqnalƒ±ndan sonra √∂z√ºnd…ôn soru≈ü:
          <br>‚Ä¢ Bu siqnal range i√ßind…ôdir, yoxsa a√ßƒ±q impulsdadƒ±r?
          <br>‚Ä¢ Saniy…ôl…ôr i√ßind…ô > THRESHOLD h…ôr…ôk…ôt + g√ºcl√º volume var?
          <br>∆èg…ôr cavab ‚Äúbilmir…ôm‚Äùdirs…ô ‚Üí h…ôl…ô q…ôrar verm…ô, a≈üaƒüƒ±dakƒ± PRO x…ôrit…ôni doldur.
        </div>
      </div>
    </div>

    <!-- SECTION 1 -->
    <div class="section" data-section="1">
      <div class="section-header" role="button" aria-label="Collapse Section 1">
        <div class="section-title">üü¶ B√∂lm…ô 1 ‚Äî Futures REAL Impulse Check
          <span class="badge critical">∆èn vacib 8 punkt</span>
        </div>
        <div class="section-score">
          Score: <span class="score-value" id="score-sec-1">0 / 8</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
      </div>

      <div class="items">
        <div class="item" data-id="1">
          <div class="item-title">1) Taker Buy/Sell Flow (Œî Taker)</div>
          <div class="item-desc">
            Bullish (LONG): Buy √ºst√ºn, ya≈üƒ±l spike, buy > 55‚Äì60%.<br>
            Kritik: Price ‚Üë amma buy z…ôif ‚Üí fake pump riski.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against / Trap</button>
          </div>
        </div>

        <div class="item" data-id="2">
          <div class="item-title">2) Basis (Futures vs Spot Premium)</div>
          <div class="item-desc">
            Bullish (LONG): Basis y√ºng√ºl ‚Üë, futures spotdan azca yuxarƒ±.<br>
            Kritik: Basis stabil / k…ôskin ‚Üë, amma price z…ôif ‚Üí manip risk.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against / Trap</button>
          </div>
        </div>

        <div class="item" data-id="3">
          <div class="item-title">3) OI / Market Cap Ratio</div>
          <div class="item-desc">
            Bullish (LONG): Ratio stabil / y√ºng√ºl ‚Üë, leverage saƒülamdƒ±r.<br>
            Kritik: Ratio ‚Üì + Price ‚Üë ‚Üí trend yorƒüun, late long riski.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="4" data-hardfail="true">
          <div class="item-title">
            4) OI Dynamics ‚Äî 4 Davranƒ±≈ü
            <span class="item-hardfail-flag">HARD-FAIL</span>
          </div>
          <div class="item-desc">
            LONG konteksind…ô:<br>
            ‚ÜëOI + ‚ÜëPrice ‚Üí continuation (LONG √º√ß√ºn yax≈üƒ±)<br>
            ‚ÜëOI + ‚ÜìPrice ‚Üí SHORT trap qurulur, LONG √º√ß√ºn t…ôhl√ºk…ôlidir<br>
            ‚ÜìOI + ‚ÜëPrice ‚Üí squeeze son faza, late long riski<br>
            ‚ÜìOI + ‚ÜìPrice ‚Üí trend bitir, NO-TRADE
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports Setup</button>
            <button class="item-btn" data-score="0" type="button">Mixed</button>
            <button class="item-btn" data-score="-1" type="button">Trap / NO-TRADE</button>
          </div>
        </div>

        <div class="item" data-id="5">
          <div class="item-title">5) Notional OI</div>
          <div class="item-desc">
            Bullish (LONG): Notional + Price birlikd…ô ‚Üë ‚Üí real capital daxil olur.<br>
            Kritik: Notional stabil / ‚Üì, amma Price ‚Üë ‚Üí retail-only pump.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="6">
          <div class="item-title">6) Top Trader Account Ratio</div>
          <div class="item-desc">
            Bullish (LONG): Retail short-heavy, pros long t…ôr…ôfd…ô.<br>
            Kritik: Retail hamƒ±sƒ± long ‚Üí FOMO, LONG √º√ß√ºn riskli zona.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Good</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Bad / Crowded</button>
          </div>
        </div>

        <div class="item" data-id="7">
          <div class="item-title">7) Top Trader Position Ratio</div>
          <div class="item-desc">
            Bullish (LONG): Pros s…ônin t…ôr…ôfd…ô (long bias).<br>
            Ziddiyy…ôt varsa ‚Äî ehtiyat, position sizing-i ki√ßilt.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Pros with me</button>
            <button class="item-btn" data-score="0" type="button">Mixed</button>
            <button class="item-btn" data-score="-1" type="button">Opposite</button>
          </div>
        </div>

        <div class="item" data-id="8">
          <div class="item-title">8) Global Long/Short Ratio</div>
          <div class="item-desc">
            Bullish (LONG): Global > 1, amma ekstremal olmadan.<br>
            Bearish (LONG √º√ß√ºn): Global √ßox y√ºks…ôkdirs…ô (crowded longs) ‚Üí risk.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Good</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Bad</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION 2 -->
    <div class="section" data-section="2">
      <div class="section-header" role="button" aria-label="Collapse Section 2">
        <div class="section-title">
          üü© B√∂lm…ô 2 ‚Äî Spot Confirmation (4 blok)
          <span class="badge">Trend davamƒ±</span>
        </div>
        <div class="section-score">
          Score: <span class="score-value" id="score-sec-2">0 / 4</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
      </div>

      <div class="items">
        <div class="item" data-id="9">
          <div class="item-title">BLOCK 1 ‚Äî Spot Money Flow</div>
          <div class="item-desc">
            LONG: Net inflow, real buy walls, yuxarƒ±ya doƒüru axƒ±n.<br>
            Bearish (LONG √º√ß√ºn): Net outflow, sell walls ‚Üí pump dayanƒ±qsƒ±zdƒ±r.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="10">
          <div class="item-title">BLOCK 2 ‚Äî Spot Volume</div>
          <div class="item-desc">
            LONG: Volume ‚Üë davamlƒ±, impuls arxasƒ±nda g√ºc var.<br>
            Bearish (LONG √º√ß√ºn): Volume s√∂n√ºr ‚Üí continuation z…ôifl…ôyir.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Good</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Bad</button>
          </div>
        </div>

        <div class="item" data-id="11">
          <div class="item-title">BLOCK 3 ‚Äî Spot Orderbook</div>
          <div class="item-desc">
            LONG: A≈üaƒüƒ±da BID walls, absorption buy, alƒ±cƒ±lar d…ôst…ôkl…ôyir.<br>
            Bearish (LONG √º√ß√ºn): Yuxarƒ±da ASK walls + spoofing ‚Üí trap riski.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="12">
          <div class="item-title">BLOCK 4 ‚Äî Spot Price Action</div>
          <div class="item-desc">
            LONG: HH/HL ‚Üí bullish structure, continuation √º√ß√ºn saƒülam.<br>
            Bearish (LONG √º√ß√ºn): LH/LF ‚Üí reversal risk, LONG √º√ß√ºn z…ôifdir.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION 3 -->
    <div class="section" data-section="3">
      <div class="section-header" role="button" aria-label="Collapse Section 3">
        <div class="section-title">
          üü™ B√∂lm…ô 3 ‚Äî Extra PRO Indicators
          <span class="badge">Detallƒ± analiz</span>
        </div>
        <div class="section-score">
          Score: <span class="score-value" id="score-sec-3">0 / 6</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
      </div>

      <div class="items">
        <div class="item" data-id="13">
          <div class="item-title">1) CVD (Cumulative Volume Delta)</div>
          <div class="item-desc">
            LONG: CVD ‚Üë + Price ‚Üë ‚Üí real buy dominance.<br>
            Divergence (Price ‚Üë, CVD ‚Üì) ‚Üí riskli continuation.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="14">
          <div class="item-title">2) Liquidation Heatmap</div>
          <div class="item-desc">
            LONG: Yuxarƒ±da cluster ‚Üí continuation target, lakin √ßox yaxƒ±nsa trap ola bil…ôr.<br>
            A≈üaƒüƒ±da b√∂y√ºk cluster ‚Üí a≈üaƒüƒ±ya dartma riski (LONG √º√ß√ºn t…ôhl√ºk…ô).
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="15">
          <div class="item-title">3) VWAP</div>
          <div class="item-desc">
            LONG: Price > VWAP v…ô VWAP √∂z√º ‚Üë ‚Üí trend saƒülamdƒ±r.<br>
            Bearish (LONG √º√ß√ºn): Price < VWAP v…ô reject ‚Üí LONG √º√ß√ºn z…ôif zona.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="16">
          <div class="item-title">4) Tape Reading</div>
          <div class="item-desc">
            LONG: ardƒ±cƒ±l ya≈üƒ±l high-size prints, sell-l…ôr absorb olunur.<br>
            Bearish (LONG √º√ß√ºn): qƒ±rmƒ±zƒ± high-size prints, buyer-lar geri √ß…ôkilir.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Good</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Bad</button>
          </div>
        </div>

        <div class="item" data-id="17">
          <div class="item-title">5) Funding Curve</div>
          <div class="item-desc">
            LONG: Normal / y√ºng√ºl pozitiv funding ok-dur.<br>
            Bearish (LONG √º√ß√ºn): funding k…ôskin ‚Üë + crowded longs ‚Üí trap riski.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="18">
          <div class="item-title">6) Implied Volatility (IV)</div>
          <div class="item-desc">
            LONG: IV ‚Üë + Price ‚Üë ‚Üí trend g√ºcl√º, lakin risk-liq artƒ±r.<br>
            IV ‚Üì + Price ‚Üë ‚Üí daha sakit continuation, leverage azalƒ±b.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Good</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Bad</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION 4 -->
    <div class="section" data-section="4">
      <div class="section-header" role="button" aria-label="Collapse Section 4">
        <div class="section-title">
          üü• B√∂lm…ô 4 ‚Äî Market Structure
          <span class="badge">4H + Local</span>
        </div>
        <div class="section-score">
          Score: <span class="score-value" id="score-sec-4">0 / 2</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
      </div>

      <div class="items">
        <div class="item" data-id="19">
          <div class="item-title">1) 4H Macro Trend</div>
          <div class="item-desc">
            LONG: Price EMA 50/200 √ºst√ºnd…ô ‚Üí makro bullish kontekst.<br>
            Bearish (LONG √º√ß√ºn): EMA-larƒ±n altƒ±nda ‚Üí LONG √º√ß√ºn …ôks trend.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against</button>
          </div>
        </div>

        <div class="item" data-id="20">
          <div class="item-title">2) Local Structure</div>
          <div class="item-desc">
            LONG: BOS up, higher highs/lows ‚Üí continuation √º√ß√ºn yax≈üƒ±.<br>
            BOS down ‚Üí local trend …ôksin…ô, LONG √º√ß√ºn riskli zona.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Good</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Bad</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SECTION 5 -->
    <div class="section" data-section="5">
      <div class="section-header" role="button" aria-label="Collapse Section 5">
        <div class="section-title">
          üüß B√∂lm…ô 5 ‚Äî BTC Regime
          <span class="badge">Altcoin Must</span>
        </div>
        <div class="section-score">
          Score: <span class="score-value" id="score-sec-5">0 / 1</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
      </div>

      <div class="items">
        <div class="item" data-id="21" data-hardfail="true">
          <div class="item-title">
            BTC Mood (OI, VWAP, Liquidity)
            <span class="item-hardfail-flag">HARD-FAIL</span>
          </div>
          <div class="item-desc">
            LONG: BTC OI ‚Üë + Price ‚Üë, VWAP √ºst√º ‚Üí altcoin LONG √º√ß√ºn saƒülam fon.<br>
            Bearish (LONG √º√ß√ºn): OI ‚Üë + Price ‚Üì ‚Üí BTC-d…ô trap / risk rejimi, NO-TRADE.
          </div>
          <div class="item-actions">
            <button class="item-btn" data-score="1" type="button">Supports</button>
            <button class="item-btn" data-score="0" type="button">Neutral</button>
            <button class="item-btn" data-score="-1" type="button">Against / NO-TRADE</button>
          </div>
        </div>
      </div>
    </div>

    <!-- FINAL CARD -->
    <div class="final-card">
      <div class="final-title">üöÄ Final Decision Map</div>

      <div class="final-score-line">
        Overall Score: <span id="finalScoreText" class="score-value">0 / 21</span>
      </div>

      <div id="finalVerdict" class="final-verdict">Status: No data</div>
      <div id="finalComment" class="final-note">Checklist-i doldur, n…ôtic…ô burada real-time yenil…ôn…ôc…ôk.</div>

      <div class="export-box">
        <div class="export-label">Telegram √º√ß√ºn Export:</div>
        <textarea id="exportText" readonly></textarea>
      </div>

      <!-- SNAPSHOT UI (V2.1+) -->
      <div class="export-box">
        <div class="export-label">Snapshot JSON (setup-a baƒülamaq √º√ß√ºn):</div>
        <textarea id="snapshotInput" placeholder='Buraya Snapshot JSON yapƒ±≈üdƒ±r (m…ôs: {"coin":"BTCUSDT","tf":"5m","entry":...})'></textarea>
        <div style="display:flex;gap:4px;margin-top:6px;flex-wrap:wrap;">
          <button id="btnAttachSnapshot" class="btn small" type="button">Snapshot-ƒ± n√∂vb…ôti Log-a baƒüla</button>
          <div id="snapshotStatus" style="font-size:0.68rem;color:var(--muted);align-self:center;"></div>
        </div>
      </div>

      <div class="export-box">
        <div class="export-label">Local Trade Log (yalnƒ±z bu cihazda saxlanƒ±lƒ±r):</div>
        <div class="trade-log-inputs">
          <input id="logSymbol" placeholder="Pair (m…ôs: BTCUSDT)" />
          <input id="logTF" placeholder="TF (m…ôs: 5m / 15m)" />
        </div>
        <button id="btnSaveTrade" class="btn small" type="button">Bu setup-ƒ± Log et</button>

        <div style="display:flex;gap:4px;margin-top:4px;flex-wrap:wrap;">
          <button id="btnExportJson" class="btn small" type="button">Export JSON</button>
          <button id="btnImportJson" class="btn small" type="button">Import JSON</button>
        </div>

        <input id="importFile" type="file" accept="application/json,text/*" style="display:none" />
        <div id="tradeLogList" class="trade-log-list"></div>
      </div>

      <div class="export-box">
        <div class="export-label">Session Comparison (V2.1) ‚Äî 2 f…ôrqli setup-ƒ± yan-yana m√ºqayis…ô et:</div>
        <div class="trade-log-inputs">
          <select id="sessionA"></select>
          <select id="sessionB"></select>
        </div>
        <button id="btnCompareSessions" class="btn small" type="button">Compare Sessions</button>
        <div id="sessionCompareResult" class="trade-log-list" style="margin-top:4px;"></div>
      </div>
    </div>

  </div>
</div>

<!-- Offline update toast -->
<div id="updateToast" class="update-toast" aria-live="polite">
  <div class="update-toast-text" id="updateToastText">Yeni versiya m√∂vcuddur ‚Äî yenil…ôm…ôk ist…ôyirs…ôn?</div>
  <div class="update-toast-actions">
    <button id="updateRefreshBtn" class="btn primary small" type="button">Refresh</button>
    <button id="updateDismissBtn" class="btn small" type="button">Sonra</button>
  </div>
</div>

<script>
(() => {
  "use strict";

  // ===========================
  // SNAPSHOT STATE (OFFLINE)
  // ===========================
  let pendingSnapshot = null;

  function safeParseSnapshot(text) {
    try {
      const obj = JSON.parse(text);
      if (!obj || typeof obj !== "object") return null;
      return obj;
    } catch {
      return null;
    }
  }

  function attachSnapshot() {
    const raw = $("snapshotInput").value.trim();
    if (!raw) {
      alert("Snapshot JSON bo≈üdur.");
      return;
    }
    const parsed = safeParseSnapshot(raw);
    if (!parsed) {
      alert("Snapshot JSON formatƒ± d√ºzg√ºn deyil.");
      return;
    }

    pendingSnapshot = {
      attachedAt: new Date().toISOString(),
      data: parsed,
      raw
    };

    $("snapshotStatus").textContent = "Snapshot n√∂vb…ôti trade √º√ß√ºn hazƒ±rdƒ±r ‚úî";
    $("snapshotStatus").style.color = "var(--accent)";
  }

  // ===========================
  // OVERRIDE YOX ‚Äî SAVE LOG (NATIVE)
  // ===========================
  function saveTradeLog() {
    const symbol = ($("logSymbol").value || "").trim();
    const tf = ($("logTF").value || "").trim();

    if (!symbol) {
      alert("Trade log √º√ß√ºn …ôn azƒ± pair (m…ôs: BTCUSDT) yaz.");
      return;
    }

    const anyScored = !!document.querySelector(".item[data-score]");
    if (!anyScored) {
      alert("∆èvv…ôlc…ô checklist-d…ôn …ôn azƒ± bir ne√ß…ô punkt i≈üar…ôl…ô.");
      return;
    }

    const entry = {
      ts: new Date().toISOString(),
      mode: currentMode,
      symbol,
      tf,
      totalScore: lastTotals.total,
      secScores: { ...lastTotals.secScores },
      hardFail: lastTotals.hardFail,
      verdict: lastTotals.verdict,
      snapshot: pendingSnapshot ? pendingSnapshot : null
    };

    tradeLog.push(entry);
    if (tradeLog.length > 200) {
      tradeLog = tradeLog.slice(tradeLog.length - 200);
    }

    pendingSnapshot = null;
    $("snapshotInput").value = "";
    $("snapshotStatus").textContent = "";

    saveTradeLogToStorage();
    renderTradeLog();
    updateSessionSelectors();

    $("logTF").value = "";
  }

  // ===========================
  // RENDER LOG (Snapshot aware)
  // ===========================
  function renderTradeLog() {
    const box = $("tradeLogList");
    if (!box) return;

    if (!tradeLog.length) {
      box.innerHTML = '<div style="color: var(--muted); font-size:0.68rem;">H…ôl…ô he√ß bir trade yoxdur.</div>';
      return;
    }

    let html = "";
    tradeLog.slice().reverse().forEach((entry, idx) => {
      const hasSnap = !!entry.snapshot;
      html += `<div class="trade-log-entry">
        <div class="trade-log-entry-header">
          [${formatTimestamp(entry.ts)}] ${entry.symbol} ${entry.tf ? "(" + entry.tf + ")" : ""}
        </div>
        <div class="trade-log-entry-meta">
          Mode: ${entry.mode} ‚Äî Score: ${entry.totalScore}/21 ‚Äî HardFail: ${entry.hardFail ? "VAR" : "Yox"}
        </div>
        <div class="trade-log-entry-meta">
          Verdict: ${entry.verdict}
        </div>
        ${hasSnap ? `<details style="margin-top:4px;">
          <summary style="cursor:pointer;color:var(--accent);font-size:0.65rem;">üì¶ Snapshot (click)</summary>
          <pre style="white-space:pre-wrap;font-size:0.62rem;color:var(--muted);margin-top:4px;">
${JSON.stringify(entry.snapshot.data, null, 2)}
          </pre>
        </details>` : ""}
      </div>`;
    });

    box.innerHTML = html;
  }

  // ===========================
  // SNAPSHOT BUTTON WIRE
  // ===========================
  $("btnAttachSnapshot").addEventListener("click", attachSnapshot);

  // ===========================
  // JSON EXPORT (Snapshot-aware)
  // ===========================
  function exportJournalJson() {
    try {
      const scores = {};
      document.querySelectorAll(".item").forEach((item) => {
        const id = item.dataset.id;
        if (!id) return;
        scores[id] = parseInt(item.dataset.score || "0", 10);
      });

      const payload = {
        version: "2.1-snapshot",
        exportedAt: new Date().toISOString(),
        mode: currentMode,
        totals: lastTotals,
        scores,
        tradeLog: tradeLog || []
      };

      const json = JSON.stringify(payload, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, "0");
      const d = String(now.getDate()).padStart(2, "0");
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");

      a.href = url;
      a.download = `pro_trend_journal_snapshot_${y}${m}${d}_${hh}${mm}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      alert("Snapshot-lƒ± Journal JSON export olundu ‚úî");
    } catch (e) {
      alert("Export zamanƒ± x…ôta ba≈ü verdi.");
    }
  }

  // ===========================
  // JSON IMPORT (Snapshot-aware)
  // ===========================
  function importJournalJson() {
    const fileInput = $("importFile");
    if (!fileInput) return;

    fileInput.value = "";
    fileInput.onchange = (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          if (!data || typeof data !== "object") throw new Error("Bad JSON");

          if (data.mode === "SHORT" || data.mode === "LONG") {
            setMode(data.mode);
          }

          if (data.scores && typeof data.scores === "object") {
            applySavedScores(data.scores);
          }

          if (Array.isArray(data.tradeLog)) {
            tradeLog = data.tradeLog;
            saveTradeLogToStorage();
          }

          recompute();
          saveStateToStorage();
          renderTradeLog();
          updateSessionSelectors();

          alert("Snapshot-lƒ± Journal JSON import olundu ‚úî");
        } catch (err) {
          console.error(err);
          alert("JSON faylƒ± d√ºzg√ºn formatda deyil.");
        }
      };
      reader.readAsText(file);
    };

    fileInput.click();
  }

  // ===========================
  // SESSION COMPARISON (Snapshot-safe)
  // ===========================
  function compareSessions() {
    const selA = $("sessionA");
    const selB = $("sessionB");
    const resBox = $("sessionCompareResult");
    if (!selA || !selB || !resBox) return;

    const idxA = parseInt(selA.value || "-1", 10);
    const idxB = parseInt(selB.value || "-1", 10);

    if (
      isNaN(idxA) || isNaN(idxB) ||
      idxA < 0 || idxB < 0 ||
      idxA >= tradeLog.length || idxB >= tradeLog.length
    ) {
      alert("M√ºqayis…ô √º√ß√ºn 2 ke√ß…ôrli sessiya se√ß.");
      return;
    }
    if (idxA === idxB) {
      alert("Eyni sessiyanƒ± m√ºqayis…ô etm…ôk olmaz.");
      return;
    }

    const A = tradeLog[idxA];
    const B = tradeLog[idxB];

    const scoresA = A.secScores || {};
    const scoresB = B.secScores || {};

    let html = "";

    html += `<div class="trade-log-entry">
      <div class="trade-log-entry-header">Session A</div>
      <div class="trade-log-entry-meta">[${formatTimestamp(A.ts)}] ${A.symbol} ${A.tf ? "(" + A.tf + ")" : ""}</div>
      <div class="trade-log-entry-meta">Score: ${A.totalScore}/21 ‚Äî HardFail: ${A.hardFail ? "VAR" : "Yox"}</div>
    </div>`;

    html += `<div class="trade-log-entry">
      <div class="trade-log-entry-header">Session B</div>
      <div class="trade-log-entry-meta">[${formatTimestamp(B.ts)}] ${B.symbol} ${B.tf ? "(" + B.tf + ")" : ""}</div>
      <div class="trade-log-entry-meta">Score: ${B.totalScore}/21 ‚Äî HardFail: ${B.hardFail ? "VAR" : "Yox"}</div>
    </div>`;

    html += `<div class="trade-log-entry">
      <div class="trade-log-entry-header">Section-by-Section</div>`;

    for (let i = 1; i <= 5; i++) {
      const sa = parseInt(scoresA[i] || 0, 10);
      const sb = parseInt(scoresB[i] || 0, 10);
      const diff = sb - sa;
      const maxVal = SECTION_MAX[i] || 1;

      html += `<div class="trade-log-entry-meta">
        ‚Ä¢ ${SECTION_NAME[i]}: A ${sa}/${maxVal} ‚Üí B ${sb}/${maxVal} (Œî ${diff >= 0 ? "+" + diff : diff})
      </div>`;
    }

    resBox.innerHTML = html;
  }

  // ===========================
  // BUTTON WIRES (Snapshot included)
  // ===========================
  btnSaveTrade.addEventListener("click", saveTradeLog);
  btnExportJson.addEventListener("click", exportJournalJson);
  btnImportJson.addEventListener("click", importJournalJson);
  btnCompareSessions.addEventListener("click", compareSessions);

  // ===========================
  // SERVICE WORKER UPDATE TOAST
  // ===========================
  function showUpdateToast() {
    if (!updateToast) return;
    updateToast.style.display = "flex";
  }

  function hideUpdateToast() {
    if (!updateToast) return;
    updateToast.style.display = "none";
  }

  async function registerServiceWorker() {
    if (!("serviceWorker" in navigator)) return;

    try {
      const reg = await navigator.serviceWorker.register("./service-worker.js", { scope: "./" });

      if (reg.waiting) {
        waitingSW = reg.waiting;
        showUpdateToast();
      }

      reg.addEventListener("updatefound", () => {
        const newWorker = reg.installing;
        if (!newWorker) return;

        newWorker.addEventListener("statechange", () => {
          if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
            waitingSW = reg.waiting || newWorker;
            showUpdateToast();
          }
        });
      });

      navigator.serviceWorker.addEventListener("controllerchange", () => {
        window.location.reload();
      });
    } catch (e) {
      // s…ôssiz fail ‚Äî offline i≈ül…ôm…ôy…ô t…ôsir etmir
    }
  }

  // ===========================
  // WIRE TOP BUTTONS
  // ===========================
  function wireTopButtons() {
    btnResetAll.addEventListener("click", resetAll);
    btnCopyExport.addEventListener("click", copyExport);

    modeLongBtn.addEventListener("click", () => setMode("LONG"));
    modeShortBtn.addEventListener("click", () => setMode("SHORT"));

    updateRefreshBtn.addEventListener("click", () => {
      try {
        if (waitingSW) waitingSW.postMessage({ type: "SKIP_WAITING" });
      } catch {}
      hideUpdateToast();
    });

    updateDismissBtn.addEventListener("click", hideUpdateToast);
  }

  // ===========================
  // BOOT SEQUENCE (FINAL)
  // ===========================
  function boot() {
    initCollapse();
    initModeTexts();
    initDelegatedButtons();
    wireTopButtons();

    // Load saved state
    const state = loadStateFromStorage();
    if (state && (state.mode === "LONG" || state.mode === "SHORT")) {
      currentMode = state.mode;
    }
    applyModeToItems();

    if (state && state.scores) {
      applySavedScores(state.scores);
    }

    // Load trade log
    loadTradeLog();

    modeLongBtn.classList.toggle("active-mode", currentMode === "LONG");
    modeShortBtn.classList.toggle("active-mode", currentMode === "SHORT");

    recompute();
    registerServiceWorker();
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", boot, { once: true });
  } else {
    boot();
  }

})();
</script>
</body>
</html>
